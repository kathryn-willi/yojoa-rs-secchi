# yojoa-rs-secchi/programs

This directory contains the scripts that collate, harmonize, and generally munge the RS, Secchi, and meteorological data into a common file. The programs are numbered in the order that they were originally run.

## Script descriptions

* 1_RS_collate_harmonize.Rmd collates and harmonizes the output from GEE for the Yojoa in-lake locations

* 2_Process_Summarize_ERA5.Rmd summarizes the ERA5 meteorological data in 3, 5, and 7 day windows.

* 3_regionalRS_collate_harmonize.Rmd: similar to script 1, this script collates and harmonizes GEE output, but here, it does this for the regional set of lakes for the handoff correction

* 4_regional_handoff_calcs.Rmd: this script takes the regional stacks and calculates handoff coefficients to provide band reflectance values relative to Landsat 7.

* 5_apply_handoff_calcs.Rmd: this script applies the handoff calcs to the Yojoa in-lake location dataset

* 6_add_era5_data.Rmd: this script adds the ERA5 summaries to the band value correction dataset.

* 7_LSC2_secchi_matchup.Rmd creates the matchup files found in the `data/matchups` folder

* 8_xgboost_stringent.Rmd runs {xgboost} gbtree for Secchi with a stringent data policy. The stringent data method uses a train-test-val set for method assessment.

* 9_xgboost_very_stringent.Rmd this method uses a train-test-val set where there is no overlap in scene-dates between any of the data sets.

* 10_xgboost_higher_secchi.Rmd this method uses the very stringent data model and adds in a weight variable defined as secchi/max(secchi)*10.

* 11_stepwise_regression_method.Rmd employs backwards stepwise regression method to develop a lighter-weight algorithm for Secchi estimation.

Script 1_RS_collate_harmonize.Rmd assumes that you have run the Landsat stack files in the 'landsat_c2' folder within this repository or have access to the Drive folder with the output created in those scripts. You will not be able to run this code if you have not completed the LS stack run or if the output has not been shared with you.

-   Filters applied: in 1_RS_collate_harmonize.Rmd, we've done the minimum filtering in 'Filter scene summaries' (dswe1 must be \> 10, IMAGE_QUALITY \>= 7). We may suggest to update this with new filters in the near future.

-   The files sameDay_LS-Secchi_matchups.csv, oneDay..., twoDay..., threeDay..., fiveDay... found in the data/matchups folder were created in the script 7_LSC2_secchi_matchup.Rmd 




# Data set column definitions, units, sources


| Column name (or prefix, suffix) | Definition                                                                                                                                                                                                                                                                                         | Missions                                            | Units                          | Data Source                   | Use Case                     |
|------------|------------|------------|------------|------------|------------|
| \*\_Blue                        | Blue band reflectance                                                                                                                                                                                                                                                                              | all                                                 | unitless                       | GEE location-specific reducer | Algorithm development, QA    |
| \*\_Green                       | Green band reflectance                                                                                                                                                                                                                                                                             | all                                                 | unitless                       | GEE location-specific reducer | Algorithm development, QA    |
| \*\_Red                         | Red band reflectance                                                                                                                                                                                                                                                                               | all                                                 | unitless                       | GEE location-specific reducer | Algorithm development, QA    |
| \*\_Nir                         | Near Infrared reflectance                                                                                                                                                                                                                                                                          | all                                                 | unitless                       | GEE location-specific reducer | Algorithm development, QA    |
| \*\_Swir1                       | Short Wave Infrared 1 reflectance                                                                                                                                                                                                                                                                  | all                                                 | unitless                       | GEE location-specific reducer | Algorithm development, QA    |
| \*\_Swir2                       | Short Wave Infrared 2 reflectance                                                                                                                                                                                                                                                                  | all                                                 | unitless                       | GEE location-specific reducer | Algorithm development, QA    |
| \*\_Aerosol                     | Coatal aerosol band (or ultra Blue band) reflectance                                                                                                                                                                                                                                               | 8/9 only                                            | unitless                       | GEE location-specific reducer | Algorithm development, QA    |
| \*\_SurfaceTemp                 | Surface temperature estimate                                                                                                                                                                                                                                                                       | all                                                 | degrees Kelvin                 | GEE location-specific reducer | **do not use**               |
| med\*                           | median value within a 90m radius                                                                                                                                                                                                                                                                   | all                                                 | N/A, column prefix             | GEE location-specific reducer | Algorithm development, QA    |
| min\*                           | minimum value within a 90m radius                                                                                                                                                                                                                                                                  | all                                                 | N/A, column prefix             | GEE location-specific reducer | Algorithm development, QA    |
| max\*                           | maximum value within a 90m radius                                                                                                                                                                                                                                                                  | all                                                 | N/A, column prefix             | GEE location-specific reducer | Algorithm development, QA    |
| Q1\*                            | first quartile value within a 90m radius                                                                                                                                                                                                                                                           | all                                                 | N/A, column prefix             | GEE location-specific reducer | Algorithm development, QA    |
| Q3\*                            | third quartile value within a 90m radius                                                                                                                                                                                                                                                           | all                                                 | N/A, column prefix             | GEE location-specific reducer | Algorithm development, QA    |
| sd\*                            | standard deviation of the mean within a 90m radius                                                                                                                                                                                                                                                 | all                                                 | N/A, column prefix             | GEE location-specific reducer | QA                           |
| kurt_SurfaceTemp                | kurtosis of the surface temperature estimate distribution                                                                                                                                                                                                                                          | all                                                 | unitless                       | GEE location-specific reducer | **do not use**               |
| prop_clouds                     | proportion pixels with clouds in a 90m radius                                                                                                                                                                                                                                                      | all                                                 | proportion of 30 x 30 m pixels | GEE location-specific reducer | QA                           |
| prop_hillShadow                 | proportion of pixels NOT shadowed by surrounding topography                                                                                                                                                                                                                                        | all                                                 | proportion of 30 x 30 m pixels | GEE location-specific reducer | QA                           |
| pCount_dswe1                    | number of pixels in a 90m radius that are considered 'confident' open water                                                                                                                                                                                                                        | all                                                 | number of 30 x 30 m pixels     | GEE location-specific reducer | QA                           |
| pCount_dswe3                    | number of pixels in a 90m radius that are considered 'potential wetland'                                                                                                                                                                                                                           | all                                                 | number of 30 x 30 m pixels     | GEE location-specific reducer | QA                           |
| \*\_cloud_dist                  | distance to cloud (for any pixel in the 90m radius)                                                                                                                                                                                                                                                | all                                                 | 1 = 0.01 km                    | GEE location-specific reducer | QA                           |
| \`system:index\`                | Landsat-specific unique system identifier for the scene                                                                                                                                                                                                                                            | all                                                 | N/A                            | Scene-level data              | N/A                          |
| prop_medHighAero                | proportion of pixels in a 90m radius that have medium of high aerosol applied in the LaSRC atmospheric correction                                                                                                                                                                                  | 8/9 only                                            | proportion of 30 x 30 m pixels | GEE location-specific reducer | QA                           |
| rowid                           | rowid for GEE process, artefact of processing                                                                                                                                                                                                                                                      | all                                                 | N/A                            | N/A                           | N/A                          |
| WRS_PATH                        | WRS2 path of the image                                                                                                                                                                                                                                                                             | all                                                 | path number                    | Scene-level data              | N/A                          |
| WRS_ROW                         | WRS2 row of the image                                                                                                                                                                                                                                                                              | all                                                 | row number                     | Scene-level data              | N/A                          |
| mission                         | Spacecraft mission identifier                                                                                                                                                                                                                                                                      | all                                                 | N/A                            | Scene-level data              | Algorithm development        |
| date                            | date of image acquisition                                                                                                                                                                                                                                                                          | all                                                 | YYYY-MM-DD date                | Scene-level data              | Algorithm development, QA    |
| obs_date                        | date of Secchi measurement                                                                                                                                                                                                                                                                         | all                                                 | YYYY-MM-DD date                | Secchi_completedataset.xlsx   | Algorithm development        |
| UTC_time                        | time of image acquisition                                                                                                                                                                                                                                                                          | all                                                 | Time in UTC                    | Scene-level data              | N/A                          |
| CLOUD_COVER                     | percent of scene with cloud cover                                                                                                                                                                                                                                                                  | all                                                 | percent                        | Scene-level data              | QA                           |
| IMAGE_QUALITY                   | scale of 0-9 quality of image for reflectance                                                                                                                                                                                                                                                      | all (this was originally IMAGE_QUALITY_OLI for 8/9) | N/A                            | Scene-level data              | QA                           |
| IMAGE_QUALITY_TIRS              | scale of 0-9 quality of image for thermal data                                                                                                                                                                                                                                                     | 8/9                                                 | N/A                            | Scene-level data              | QA                           |
| SUN_AZIMUTH                     | Sun azimuth angle in degrees for the image center location at the image center acquisition time. A positive value indicates angles to the east or clockwise from the north. A negative value indicates angles to the west or counterclockwise from the north.                                      | all                                                 | degrees                        | Scene-level data              | QA                           |
| SUN_ELEVATION                   | Sun elevation angle in degrees for the image center location at the image center acquisition time. A positive value indicates a daytime scene. A negative value indicates a nighttime scene. Note: For reflectance calculation, the sun zenith angle is needed, which is 90 - sun elevation angle. | all                                                 | degrees                        | Scene-level data              | QA                           |
| sat                             | artefact of processing, ignore                                                                                                                                                                                                                                                                     | N/A                                                 | N/A                            | N/A                           | no use                       |
| location                        | Yojoa-specific location - matches with the site location                                                                                                                                                                                                                                           | N/A                                                 | N/A                            | N/A                           | location_lat_longs_YOJOA.csv |
