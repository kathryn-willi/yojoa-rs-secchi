---
title: "Yojoa Remote Sensing Methods"
author: B Steele, Matt Ross
format: html
editor: visual
---

```{r, include = F}
library(tidyverse)
library(ggthemes)

rs_dir = 'data/upstreamRS/'
match_dir = 'data/matchups/'
```

# Methods

```{r, include = F}
stack = read.csv(file.path(rs_dir, 'yojoa_corr_rrs_met_v2023-06-15.csv'))
match = read.csv(file.path(match_dir, 'fiveDay_LS-Secchi_matchups_n237.csv'))

ls5_tot = stack %>% 
  filter(mission == 'LANDSAT_5') 

ls7_tot = stack %>% 
  filter(mission == 'LANDSAT_7') 

ls8_tot = stack %>% 
  filter(mission == 'LANDSAT_8') 

ls9_tot = stack %>% 
  filter(mission == 'LANDSAT_9') 

ls5_match = match %>% 
  filter(mission == 'LANDSAT_5')

ls7_match = match %>% 
  filter(mission == 'LANDSAT_7') 

ls8_match = match %>% 
  filter(mission == 'LANDSAT_8') 

ls9_match = match %>% 
  filter(mission == 'LANDSAT_9') 

```

## Landsat Stack

Median Landsat Collection 2 Surface Reflectance (Masek, et al., 2006, Vermote, et al., 2016) values (Rrs) were obtained for the 18 sampling locations in Lake Yojoa following the methods described in Topp, et al. (2021). The Landsat stack was comprised of `r length(unique(stack$system.index))` unique scenes comprised of data from Landsat 5, 7, 8, and 9 (Table 1). Minor adaptations were made for the transition for Collection 1 to Collection 2 Landsat data to account for differences in scaling factors between collections. Data were filtered for reasonable values for water reflectance (-0.01 \< Rrs \< 0.2) for all bands (Blue, Red, Green, Near Infrared, Shortwave Infrared 1, Shortwave Infrared 2). Inter-mission handoff coefficients to standardize Rrs values due to slight changes in sensors and atmospheric correction between missions (Gardner, et al. 2021) were calculated based on Landsat Collection 2 data acquired from all lakes greater than 25 hectacres within Guatemala, Honduras, and El Salvador (described in Supplemental Methods). All Landsat data were acquired using the Google Earth Engine Python Application Programming Interface (API) in RStudio version 2023.03.0, R version 4.2.3 (R Core Team 2023), and Python version 3.8 (Python Software Foundation, <https://www.python.org/>).

| Landsat Mission | Number of Unique Scenes                  | Number of Unique Scenes with ±5 day matchups | Total number of Available Landsat-Location overpasses | Total number of Landsat-*in situ* Secchi matches |
|---------------|---------------|---------------|---------------|---------------|
| Landsat 5       | `r length(unique(ls5_tot$system.index))` | `r length(unique(ls5_match$system.index))`   | `r nrow(ls5_tot)`                                     | `r nrow(ls5_match)`                              |
| Landsat 7       | `r length(unique(ls7_tot$system.index))` | `r length(unique(ls7_match$system.index))`   | `r nrow(ls7_tot)`                                     | `r nrow(ls7_match)`                              |
| Landsat 8       | `r length(unique(ls8_tot$system.index))` | `r length(unique(ls8_match$system.index))`   | `r nrow(ls8_tot)`                                     | `r nrow(ls8_match)`                              |
| Landsat 9       | `r length(unique(ls9_tot$system.index))` | `r length(unique(ls9_match$system.index))`   | `r nrow(ls9_tot)`                                     | `r nrow(ls9_match)`                              |
| Total           | `r length(unique(stack$system.index))`   | `r length(unique(match$syste.index))`        | `r nrow(stack)`                                       | `r nrow(match)`                                  |

: Table 1

## Secchi-RS matchups

Secchi data were matched with records from the Landsat remote sensing stack at a number of time windows: same, one, two, three, and five day windows. Windows up to ±7 days have yielded reasonable results when paired with remote sensing data (Kloiber, et al. 2002). We avoided discrete over-matching of our data by assuring that each satellite overpass instance was only paired with the nearest-in-time Secchi measurement and that each discrete Secchi measurement was only paired with a single, nearest-in-time valid satellite overpass.

## Climate Data

Climate data were aqcuired from the ERA5 dataset (Muñoz, 2019) in the Google Earth Engine Code Editor (Gorelick, 2017) from a single data point at the approximate geographical center of Lake Yojoa (14.8768°N, 87.9791°W) for all available data. ERA5 data provide daily modeled values for an extensive list of parameters; however, we only used total precipitation, mean air temperature, total solar radiation, and mean wind speed in our analysis. These data were aggregated for the previous 1 day, 3 days, and 5 days.

## xgboost Model

We used the R package {xgboost} (Chen, et al. 2023) to develop the best performing gradient tree boost algorithm for these data. The best performing model that balanced matchups and model variance were those built on matchups within a ±5 day window and used ERA5 data from the previous 5 days. Model features were median Rrs values for the blue, green, red and near infrared bands, the ratio of red to green, blue to green, red to blue, green to red, total solar radiation, maximum air temperature, minimum air temperature, total precipitation, and mean wind speed for the previous 5 days.

------------------------------------------------------------------------

# Results

------------------------------------------------------------------------

# Supplemental Methods

## Regional Handoff Coefficients

Median Landsat Collection 2 Surface Reflectance values were obtained for the Chebyshev center (Yang, 2020) for all lakes greater than 25 hectacres within or touching the boundaries of the countries of Guatemala, Honduras, and El Salvador from the spatial dataset produced by Messager, et al. (2016). Acquisition of these data followed the same methods as those for Lake Yojoa described above.

------------------------------------------------------------------------

# Acknowledgements

Landsat Collection 2 Level 2 Science Products courtesy of the U.S. Geological Survey.

# Citations

Chen T, He T, Benesty M, Khotilovich V, Tang Y, Cho H, Chen K, Mitchell R, Cano I, Zhou T, Li M, Xie J, Lin M, Geng Y, Li Y, Yuan J (2023). \_xgboost: Extreme Gradient Boosting\_. R package version 1.7.3.1, \<https://CRAN.R-project.org/package=xgboost\>.

Gardner, J. R., Yang, X., Topp, S. N., Ross, M. R.. V., Altenau, E. H., & Pavelsky, T. M. (2021). The color of rivers. *Geophysical Research Letters*, 48, e2020GL088946. <https://doi.org/10.1029/2020GL088946>

Gorelick, N., Hancher, M., Dixon, M., Ilyushchenko, S., Thau, D., & Moore, R. (2017). Google Earth Engine: Planetary-scale geospatial analysis for everyone. *Remote sensing of Environment*, *202*, 18-27.

Jones, J. (2019). Improved automated detection of subpixel-scale inundation-revised dynamic surface water extent (DSWE) Partial surface water tests. Remote Sensing, **11**(4), 374. <https://doi.org/10.3390/rs11040374>

Kloiber, S. M., Brezonik, P. L., Olmanson, L. G., & Bauer, M. E. (2002). A procedure for regional lake water clarity assessment using Landsat multispectral data. *Remote sensing of Environment*, *82*(1), 38-47.

Muñoz Sabater, J., (2019): ERA5-Land daily averaged data from 1981 to present. Copernicus Climate Change Service (C3S) Climate Data Store (CDS). (2023-03-30).

Messager, M.L., Lehner, B., Grill, G., Nedeva, I., Schmitt, O. (2016). Estimating the volume and age of water stored in global lakes using a geo-statistical approach. Nature Communications, 7: 13603. https://doi.org/10.1038/ncomms13603

Masek, J.G., Vermote, E.F., Saleous N.E., Wolfe, R., Hall, F.G., Huemmrich, K.F., Gao, F., Kutler, J., and Lim, T-K. (2006). A Landsat surface reflectance dataset for North America, 1990--2000. IEEE Geoscience and Remote Sensing Letters 3(1):68-72. <http://dx.doi.org/10.1109/LGRS.2005.857030>.

R Core Team (2023). R: A language and environment for statistical computing. R Foundation for Statistical Computing, Vienna, Austria. URL https://www.R-project.org/.

Topp, S. N., Pavelsky, T. M., Dugan, H. A., Yang, X., Gardner, J., & Ross, M. R. V. (2021). Shifting patterns of summer lake color phenology in over 26,000 US lakes. *Water Resources Research*, 57, e2020WR029123. <https://doi.org/10.1029/2020WR029123>

Vermote, E., Justice, C., Claverie, M., & Franch, B. (2016). Preliminary analysis of the performance of the Landsat 8/OLI land surface reflectance product. Remote Sensing of Environment. <http://dx.doi.org/10.1016/j.rse.2016.04.008>.

Yang, Xiao. (2020). Deepest point calculation for any given polygon using Google Earth Engine JavaScript API (Version v2). Zenodo. https://doi.org/10.5281/zenodo.6341960
